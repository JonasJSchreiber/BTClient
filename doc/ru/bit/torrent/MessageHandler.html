<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_02) on Mon Aug 13 00:10:10 EDT 2012 -->
<title>MessageHandler</title>
<meta name="date" content="2012-08-13">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="MessageHandler";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/MessageHandler.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../ru/bit/torrent/Message.html" title="class in ru.bit.torrent"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../ru/bit/torrent/MessageSender.html" title="class in ru.bit.torrent"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?ru/bit/torrent/MessageHandler.html" target="_top">Frames</a></li>
<li><a href="MessageHandler.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">ru.bit.torrent</div>
<h2 title="Class MessageHandler" class="title">Class MessageHandler</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>ru.bit.torrent.MessageHandler</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd>java.lang.Runnable</dd>
</dl>
<hr>
<br>
<pre>public class <span class="strong">MessageHandler</span>
extends java.lang.Object
implements java.lang.Runnable</pre>
<div class="block">This class is used to facilitate communication between a "Manager" and each one of its' peers; that is, for every Peer that
 Manager wants to connect to, a new MessageHandler is created. MessageHandler is responsible for requesting and sending
 all the various methods and pieces of the file.</div>
<dl><dt><span class="strong">Author:</span></dt>
  <dd>Dylan Murray, Jonas Schreiber, Charles Zuppe</dd></dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private int</code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#currentPieceIndex">currentPieceIndex</a></strong></code>
<div class="block">Current Piece (so that the decode on the last piece doesn't think it is still standard pieceLength), is set to -1
 when we are not currently in the middle of a piece reception.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private java.io.DataInputStream</code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#in">in</a></strong></code>
<div class="block">The input stream we'll use to interact with a peer.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private <a href="../../../ru/bit/torrent/Manager.html" title="class in ru.bit.torrent">Manager</a></code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#manager">manager</a></strong></code>
<div class="block">The Manager to which this MessageHandler is communicating with.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private <a href="../../../ru/bit/torrent/MessageSender.html" title="class in ru.bit.torrent">MessageSender</a></code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#messageSender">messageSender</a></strong></code>
<div class="block">Message sender responsible for sending messages to peer.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private java.io.DataOutputStream</code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#out">out</a></strong></code>
<div class="block">The output stream we'll use to interact with a peer.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private java.util.ArrayList&lt;<a href="../../../ru/bit/torrent/PieceMessage.html" title="class in ru.bit.torrent">PieceMessage</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#partialPieces">partialPieces</a></strong></code>
<div class="block">The subdivisions of pieces.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private <a href="../../../ru/bit/torrent/Peer.html" title="class in ru.bit.torrent">Peer</a></code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#peer">peer</a></strong></code>
<div class="block">The Peer to which this MessageHandler is communicating with.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private java.lang.Thread</code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#speedCalcForPeer">speedCalcForPeer</a></strong></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private int</code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#subdivisionSize">subdivisionSize</a></strong></code>
<div class="block">Subdivision size</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private <a href="../../../ru/bit/torrent/TorrentInfo.html" title="class in ru.bit.torrent">TorrentInfo</a></code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#torrentInfo">torrentInfo</a></strong></code>
<div class="block">The TorrenInfo object corresponding to the torrent we're dealing with.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#MessageHandler(ru.bit.torrent.Manager, ru.bit.torrent.Peer, ru.bit.torrent.TorrentInfo)">MessageHandler</a></strong>(<a href="../../../ru/bit/torrent/Manager.html" title="class in ru.bit.torrent">Manager</a>&nbsp;manager,
              <a href="../../../ru/bit/torrent/Peer.html" title="class in ru.bit.torrent">Peer</a>&nbsp;peer,
              <a href="../../../ru/bit/torrent/TorrentInfo.html" title="class in ru.bit.torrent">TorrentInfo</a>&nbsp;torrentInfo)</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#addToQueue(ru.bit.torrent.Message)">addToQueue</a></strong>(<a href="../../../ru/bit/torrent/Message.html" title="class in ru.bit.torrent">Message</a>&nbsp;message)</code>
<div class="block">Adds a message to this message handler's peer's queue</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private int</code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#calcPieceLength(int)">calcPieceLength</a></strong>(int&nbsp;pieceIndex)</code>
<div class="block">Calculates the length of a piece to request (it'll typically just be the regular piece length, but if it's the last
 piece it's going to be a bit smaller.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#checkPeersPieces()">checkPeersPieces</a></strong>()</code>
<div class="block">Checks what pieces the peer has and if it has any worthwhile, then request it.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#closeConnections()">closeConnections</a></strong>()</code>
<div class="block">Closes input/output streams and closes the socket.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#concatenate()">concatenate</a></strong>()</code>
<div class="block">This stores the partial pieces until we have a full piece.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#disposeCurrPiece()">disposeCurrPiece</a></strong>()</code>
<div class="block">Disposes of any partially-downloaded pieces, and sets the inProg status of this index to false.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private byte[]</code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#generateHandshake()">generateHandshake</a></strong>()</code>
<div class="block">Generates the byte sequences needed to handshake a peer.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private boolean</code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#manageHandshake()">manageHandshake</a></strong>()</code>
<div class="block">Performs a handshake, returns false if unsuccessful.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#managePeerConnection()">managePeerConnection</a></strong>()</code>
<div class="block">Manages all p2p I/O.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#processMessage(ru.bit.torrent.Message, ru.bit.torrent.Peer)">processMessage</a></strong>(<a href="../../../ru/bit/torrent/Message.html" title="class in ru.bit.torrent">Message</a>&nbsp;message,
              <a href="../../../ru/bit/torrent/Peer.html" title="class in ru.bit.torrent">Peer</a>&nbsp;peer)</code>
<div class="block">This method takes a message sent by a peer, and reacts to it depending on message type.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#processRequestMessage(ru.bit.torrent.RequestMessage)">processRequestMessage</a></strong>(<a href="../../../ru/bit/torrent/RequestMessage.html" title="class in ru.bit.torrent">RequestMessage</a>&nbsp;message)</code>
<div class="block">Takes a Request Message and if everything checks out it sends out the piece.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#resetUploadStats()">resetUploadStats</a></strong>()</code>
<div class="block">This is necessary because PerformanceAnalyzer and Peer don't have a handle on MessageSender but they do have a handle
 on MessageHandler, which has a handle on MessageSender.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#run()">run</a></strong>()</code>
<div class="block">The run() method of this runnable - where the thread gets started.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#sendBitfield()">sendBitfield</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><strong><a href="../../../ru/bit/torrent/MessageHandler.html#sendNextRequestMessage(int, int)">sendNextRequestMessage</a></strong>(int&nbsp;index,
                      int&nbsp;begin)</code>
<div class="block">Takes the index and begin of PREVIOUS request message and USES it to calculate the NEXT request message.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="manager">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>manager</h4>
<pre>private&nbsp;<a href="../../../ru/bit/torrent/Manager.html" title="class in ru.bit.torrent">Manager</a> manager</pre>
<div class="block">The Manager to which this MessageHandler is communicating with.</div>
</li>
</ul>
<a name="peer">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>peer</h4>
<pre>private&nbsp;<a href="../../../ru/bit/torrent/Peer.html" title="class in ru.bit.torrent">Peer</a> peer</pre>
<div class="block">The Peer to which this MessageHandler is communicating with.</div>
</li>
</ul>
<a name="out">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>out</h4>
<pre>private&nbsp;java.io.DataOutputStream out</pre>
<div class="block">The output stream we'll use to interact with a peer.</div>
</li>
</ul>
<a name="in">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>in</h4>
<pre>private&nbsp;java.io.DataInputStream in</pre>
<div class="block">The input stream we'll use to interact with a peer.</div>
</li>
</ul>
<a name="torrentInfo">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>torrentInfo</h4>
<pre>private&nbsp;<a href="../../../ru/bit/torrent/TorrentInfo.html" title="class in ru.bit.torrent">TorrentInfo</a> torrentInfo</pre>
<div class="block">The TorrenInfo object corresponding to the torrent we're dealing with.</div>
</li>
</ul>
<a name="partialPieces">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>partialPieces</h4>
<pre>private&nbsp;java.util.ArrayList&lt;<a href="../../../ru/bit/torrent/PieceMessage.html" title="class in ru.bit.torrent">PieceMessage</a>&gt; partialPieces</pre>
<div class="block">The subdivisions of pieces.</div>
</li>
</ul>
<a name="subdivisionSize">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>subdivisionSize</h4>
<pre>private&nbsp;int subdivisionSize</pre>
<div class="block">Subdivision size</div>
</li>
</ul>
<a name="currentPieceIndex">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>currentPieceIndex</h4>
<pre>private&nbsp;int currentPieceIndex</pre>
<div class="block">Current Piece (so that the decode on the last piece doesn't think it is still standard pieceLength), is set to -1
 when we are not currently in the middle of a piece reception.</div>
</li>
</ul>
<a name="messageSender">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>messageSender</h4>
<pre>private&nbsp;<a href="../../../ru/bit/torrent/MessageSender.html" title="class in ru.bit.torrent">MessageSender</a> messageSender</pre>
<div class="block">Message sender responsible for sending messages to peer. Gets instantiated after handshaking with peer (after we're
 connected).</div>
</li>
</ul>
<a name="speedCalcForPeer">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>speedCalcForPeer</h4>
<pre>private&nbsp;java.lang.Thread speedCalcForPeer</pre>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="MessageHandler(ru.bit.torrent.Manager, ru.bit.torrent.Peer, ru.bit.torrent.TorrentInfo)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>MessageHandler</h4>
<pre>public&nbsp;MessageHandler(<a href="../../../ru/bit/torrent/Manager.html" title="class in ru.bit.torrent">Manager</a>&nbsp;manager,
              <a href="../../../ru/bit/torrent/Peer.html" title="class in ru.bit.torrent">Peer</a>&nbsp;peer,
              <a href="../../../ru/bit/torrent/TorrentInfo.html" title="class in ru.bit.torrent">TorrentInfo</a>&nbsp;torrentInfo)</pre>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>manager</code> - </dd><dd><code>peer</code> - </dd><dd><code>torrentInfo</code> - </dd></dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="managePeerConnection()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>managePeerConnection</h4>
<pre>private&nbsp;void&nbsp;managePeerConnection()
                           throws java.lang.Exception</pre>
<div class="block">Manages all p2p I/O. (ie sends/ verifies handshake and sends/receives messages)</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>p</code> - </dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="closeConnections()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>closeConnections</h4>
<pre>private&nbsp;void&nbsp;closeConnections()
                       throws java.io.IOException</pre>
<div class="block">Closes input/output streams and closes the socket.</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd></dl>
</li>
</ul>
<a name="manageHandshake()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>manageHandshake</h4>
<pre>private&nbsp;boolean&nbsp;manageHandshake()
                         throws java.io.IOException</pre>
<div class="block">Performs a handshake, returns false if unsuccessful.</div>
<dl><dt><span class="strong">Returns:</span></dt><dd></dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd></dl>
</li>
</ul>
<a name="generateHandshake()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>generateHandshake</h4>
<pre>private&nbsp;byte[]&nbsp;generateHandshake()</pre>
<div class="block">Generates the byte sequences needed to handshake a peer. Formatted as such:
                
 Handshaking between peers begins with byte nineteen followed by the string 'BitTorrent protocol'. 
 After the fixed headers are 8 reserved bytes which are set to 0. Next is the 20-byte SHA-1 hash of the 
 bencoded form of the info value from the metainfo (.torrent) file. The next 20-bytes are the peer id generated 
 by the client. The info_hash should be the same as sent to the tracker, and the peer_id is the same as sent to 
 the tracker. If the info_hash is different between two peers, then the connection is dropped.
 
 All integers are encoded as 4-bytes big-endian (e.g. 1,234 should be encoded as (hex) 00 00 04 d2).
 The peer_id should be randomly-generated for each process your program generates. (Meaning that it should probably 
 change in some way each time the client is run.)  Stick to alphanumerics for easier debugging.</div>
<dl><dt><span class="strong">Returns:</span></dt><dd>Returns the byte[] representing a p2p handshake.</dd></dl>
</li>
</ul>
<a name="calcPieceLength(int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>calcPieceLength</h4>
<pre>private&nbsp;int&nbsp;calcPieceLength(int&nbsp;pieceIndex)</pre>
<div class="block">Calculates the length of a piece to request (it'll typically just be the regular piece length, but if it's the last
 piece it's going to be a bit smaller.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>pieceIndex</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd></dd></dl>
</li>
</ul>
<a name="processMessage(ru.bit.torrent.Message, ru.bit.torrent.Peer)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>processMessage</h4>
<pre>private&nbsp;void&nbsp;processMessage(<a href="../../../ru/bit/torrent/Message.html" title="class in ru.bit.torrent">Message</a>&nbsp;message,
                  <a href="../../../ru/bit/torrent/Peer.html" title="class in ru.bit.torrent">Peer</a>&nbsp;peer)
                     throws java.lang.Exception</pre>
<div class="block">This method takes a message sent by a peer, and reacts to it depending on message type.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>message</code> - The message received by peer.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="processRequestMessage(ru.bit.torrent.RequestMessage)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>processRequestMessage</h4>
<pre>private&nbsp;void&nbsp;processRequestMessage(<a href="../../../ru/bit/torrent/RequestMessage.html" title="class in ru.bit.torrent">RequestMessage</a>&nbsp;message)
                            throws java.io.IOException</pre>
<div class="block">Takes a Request Message and if everything checks out it sends out the piece.</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd></dl>
</li>
</ul>
<a name="disposeCurrPiece()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>disposeCurrPiece</h4>
<pre>private&nbsp;void&nbsp;disposeCurrPiece()</pre>
<div class="block">Disposes of any partially-downloaded pieces, and sets the inProg status of this index to false.</div>
</li>
</ul>
<a name="checkPeersPieces()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkPeersPieces</h4>
<pre>private&nbsp;void&nbsp;checkPeersPieces()
                       throws java.io.IOException</pre>
<div class="block">Checks what pieces the peer has and if it has any worthwhile, then request it.</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd></dl>
</li>
</ul>
<a name="addToQueue(ru.bit.torrent.Message)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>addToQueue</h4>
<pre>public&nbsp;void&nbsp;addToQueue(<a href="../../../ru/bit/torrent/Message.html" title="class in ru.bit.torrent">Message</a>&nbsp;message)</pre>
<div class="block">Adds a message to this message handler's peer's queue</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>message</code> - </dd></dl>
</li>
</ul>
<a name="sendNextRequestMessage(int, int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>sendNextRequestMessage</h4>
<pre>private&nbsp;void&nbsp;sendNextRequestMessage(int&nbsp;index,
                          int&nbsp;begin)
                             throws java.io.IOException</pre>
<div class="block">Takes the index and begin of PREVIOUS request message and USES it to calculate the NEXT request message.
 The begin passed to this method is NOT the begin that will be requested.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>index</code> - </dd><dd><code>begin</code> - </dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd></dl>
</li>
</ul>
<a name="concatenate()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>concatenate</h4>
<pre>private&nbsp;void&nbsp;concatenate()
                  throws java.lang.Exception</pre>
<div class="block">This stores the partial pieces until we have a full piece.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>partialPieces</code> - </dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="sendBitfield()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>sendBitfield</h4>
<pre>public&nbsp;void&nbsp;sendBitfield()
                  throws java.io.IOException</pre>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd></dl>
</li>
</ul>
<a name="resetUploadStats()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>resetUploadStats</h4>
<pre>public&nbsp;void&nbsp;resetUploadStats()</pre>
<div class="block">This is necessary because PerformanceAnalyzer and Peer don't have a handle on MessageSender but they do have a handle
 on MessageHandler, which has a handle on MessageSender. Therefore the call must go through the messageSender.</div>
</li>
</ul>
<a name="run()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>run</h4>
<pre>public&nbsp;void&nbsp;run()</pre>
<div class="block">The run() method of this runnable - where the thread gets started.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code>run</code>&nbsp;in interface&nbsp;<code>java.lang.Runnable</code></dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/MessageHandler.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../ru/bit/torrent/Message.html" title="class in ru.bit.torrent"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../ru/bit/torrent/MessageSender.html" title="class in ru.bit.torrent"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?ru/bit/torrent/MessageHandler.html" target="_top">Frames</a></li>
<li><a href="MessageHandler.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
